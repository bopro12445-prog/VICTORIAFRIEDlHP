<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Forever Love ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #ff4d6d; --secondary: #ff85a1; }
        body { margin: 0; overflow: hidden; font-family: 'Quicksand', sans-serif; background: #0a0a0a; }
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
        }
        
        /* Hi·ªÉn th·ªã card ƒë·∫ßu ti√™n */
        .glass-card.active { display: block; opacity: 1; z-index: 100; }

        .handwritten {
            font-family: 'Dancing Script', cursive;
            font-size: 3rem;
            color: var(--primary);
            text-shadow: 0 0 15px rgba(255, 77, 109, 0.3);
        }
        
        .btn-love {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white; padding: 15px 40px; border-radius: 100px;
            font-weight: bold; text-transform: uppercase; letter-spacing: 2px;
            transition: all 0.3s; border: none; cursor: pointer;
            box-shadow: 0 10px 20px rgba(255, 77, 109, 0.4);
        }

        #music-btn {
            position: fixed; bottom: 30px; right: 30px; z-index: 1000;
            background: rgba(255, 255, 255, 0.2); border: none; border-radius: 50%;
            width: 50px; height: 50px; color: white; font-size: 24px;
            cursor: pointer; backdrop-filter: blur(5px);
        }
    </style>
</head>
<body>

    <audio id="bgMusic" loop preload="auto">
        <source src="https://www.bensound.com/bensound-music/bensound-cute.mp3" type="audio/mpeg">
    </audio>

    <div id="canvas-container"></div>
    <button id="music-btn">üîá</button>

    <div id="app" class="flex items-center justify-center h-screen relative z-10">
        <div class="step glass-card active p-10 max-w-md w-full text-center" id="step1">
            <div class="handwritten mb-4">Xin ch√†o c√¥ng ch√∫a...</div>
            <p class="text-white/80 text-lg mb-8">Anh c√≥ m·ªôt ƒëi·ªÅu nh·ªè b√© mu·ªën d√†nh ri√™ng cho em.</p>
            <button class="btn-love" id="btn-1">Kh√°m ph√° ngay ‚ù§Ô∏è</button>
        </div>

        <div class="step glass-card p-10 max-w-md w-full text-center" id="step2">
            <h2 class="text-3xl font-bold text-white mb-6 text-gradient">Happy Birthday, My Everything! üéÇ</h2>
            <p class="text-white/70 leading-relaxed mb-6">V√†o ng√†y ƒë·∫∑c bi·ªát n√†y, anh ch·ªâ mu·ªën n√≥i r·∫±ng em l√† m√≥n qu√† tuy·ªát v·ªùi nh·∫•t m√† cu·ªôc ƒë·ªùi ƒë√£ t·∫∑ng cho anh.</p>
            <button class="btn-love" id="btn-2">Ti·∫øp t·ª•c n√†o ‚ú®</button>
        </div>

        <div class="step glass-card p-10 max-w-md w-full text-center" id="step3">
            <h2 class="text-2xl font-bold text-white mb-8 italic">T·∫°i sao em l·∫°i ƒë·∫∑c bi·ªát ƒë·∫øn th·∫ø?</h2>
            <div class="grid grid-cols-2 gap-4 text-white">
                <div class="p-4 bg-white/5 rounded-2xl border border-white/10">üíñ S·ª± d·ªãu d√†ng</div>
                <div class="p-4 bg-white/5 rounded-2xl border border-white/10">üòä N·ª• c∆∞·ªùi</div>
                <div class="p-4 bg-white/5 rounded-2xl border border-white/10">üåü C√°ch em quan t√¢m</div>
                <div class="p-4 bg-white/5 rounded-2xl border border-white/10">üî• L√† ch√≠nh em</div>
            </div>
            <button class="btn-love mt-8" id="btn-3">M·ªôt b·∫•t ng·ªù cu·ªëi... üéÅ</button>
        </div>

        <div class="step glass-card p-10 max-w-md w-full text-center" id="step4">
            <div class="handwritten mb-6">G·ª≠i t·ªõi ng∆∞·ªùi anh th∆∞∆°ng...</div>
            <div id="typing-text" class="text-white text-xl leading-loose min-h-[150px]"></div>
            <button class="btn-love mt-8" id="final-btn" style="display: none;">Celebrate Our Love! ü•Ç</button>
        </div>
    </div>

    <script>
        // 1. Three.js - Tr√°i tim bay 
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        camera.position.z = 30;

        const heartShape = new THREE.Shape();
        heartShape.moveTo(0, 0);
        heartShape.bezierCurveTo(0, 0, -1, 1, -2, 1);
        heartShape.bezierCurveTo(-4, 1, -4, -1.5, -4, -1.5);
        heartShape.bezierCurveTo(-4, -3, -2, -5, 0, -7);
        heartShape.bezierCurveTo(2, -5, 4, -3, 4, -1.5);
        heartShape.bezierCurveTo(4, -1.5, 4, 1, 2, 1);
        heartShape.bezierCurveTo(1, 1, 0, 0, 0, 0);

        const hearts = [];
        for(let i=0; i<40; i++) {
            const geo = new THREE.ShapeGeometry(heartShape);
            const mat = new THREE.MeshBasicMaterial({ color: Math.random() > 0.5 ? 0xff4d6d : 0xffb3c1, transparent: true, opacity: 0.5 });
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set(Math.random()*100-50, Math.random()*100-50, Math.random()*50-25);
            mesh.rotation.z = Math.PI;
            mesh.scale.set(0.4, 0.4, 0.4);
            scene.add(mesh);
            hearts.push(mesh);
        }

        function animate() {
            requestAnimationFrame(animate);
            hearts.forEach(h => {
                h.position.y += 0.05;
                if(h.position.y > 30) h.position.y = -30;
                h.rotation.y += 0.02;
            });
            renderer.render(scene, camera);
        }
        animate();

        // 2. Logic ƒëi·ªÅu khi·ªÉn ch√≠nh
        const audio = document.getElementById('bgMusic');
        const musicBtn = document.getElementById('music-btn');
        let isMusicPlaying = false;

        function showStep(currentId, nextId) {
            const current = document.getElementById(currentId);
            const next = document.getElementById(nextId);
            
            gsap.to(current, { opacity: 0, scale: 0.8, duration: 0.5, onComplete: () => {
                current.style.display = 'none';
                next.style.display = 'block';
                gsap.fromTo(next, { opacity: 0, scale: 0.8 }, { opacity: 1, scale: 1, duration: 0.8 });
            }});
        }

        // B·∫Øt ƒë·∫ßu - K√≠ch ho·∫°t nh·∫°c ·ªü ƒë√¢y
        document.getElementById('btn-1').onclick = () => {
            audio.play().then(() => {
                isMusicPlaying = true;
                musicBtn.innerText = "üéµ";
            }).catch(e => console.log("Audio play blocked"));
            showStep('step1', 'step2');
        };

        document.getElementById('btn-2').onclick = () => showStep('step2', 'step3');
        document.getElementById('btn-3').onclick = () => {
            showStep('step3', 'step4');
            startTyping();
        };

        musicBtn.onclick = () => {
            if(isMusicPlaying) { audio.pause(); musicBtn.innerText = "üîá"; }
            else { audio.play(); musicBtn.innerText = "üéµ"; }
            isMusicPlaying = !isMusicPlaying;
        };

        // 3. Hi·ªáu ·ª©ng g√µ ch·ªØ
        const messages = [
            "Ch√∫c em tu·ªïi m·ªõi th·∫≠t nhi·ªÅu ni·ªÅm vui v√† h·∫°nh ph√∫c ‚ù§Ô∏è",
            "C·∫£m ∆°n em v√¨ ƒë√£ ƒë·∫øn v√† l√†m th·∫ø gi·ªõi c·ªßa anh tr·ªü n√™n r·∫°ng r·ª° h∆°n.",
            "Ch√∫c m·ª´ng sinh nh·∫≠t c√¥ng ch√∫a c·ªßa anh! üéÇ‚ú®"
        ];

        function startTyping() {
            let line = 0; let char = 0;
            const target = document.getElementById('typing-text');
            function type() {
                if (line < messages.length) {
                    if (char < messages[line].length) {
                        target.innerHTML += messages[line].charAt(char);
                        char++; setTimeout(type, 60);
                    } else {
                        target.innerHTML += "<br><br>";
                        line++; char = 0; setTimeout(type, 700);
                    }
                } else {
                    const finalBtn = document.getElementById('final-btn');
                    finalBtn.style.display = 'inline-block';
                    gsap.from(finalBtn, { opacity: 0, y: 20, duration: 1 });
                }
            }
            setTimeout(type, 500);
        }

        // 4. Ph√°o hoa tr√°i tim
        document.getElementById('final-btn').onclick = function() {
            const end = Date.now() + (10 * 1000);
            (function frame() {
                confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#ff4d6d', '#ffffff'], shapes: ['heart'] });
                confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#ff4d6d', '#ffffff'], shapes: ['heart'] });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
            this.innerText = "Y√äU EM M√ÉI M√ÉI! ‚ù§Ô∏è";
            gsap.to(this, { scale: 1.2, duration: 0.5, yoyo: true, repeat: -1 });
        };

        window.onresize = () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>
