<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Forever Love ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #ff4d6d; --secondary: #ff85a1; }
        body { margin: 0; background: #0a0a0a; color: #fff; font-family: 'Quicksand', sans-serif; overflow-x: hidden; }
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .glass-card {
            background: rgba(20, 20, 20, 0.85);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            display: none;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }
        .glass-card.active { display: block; }
        .handwritten { font-family: 'Dancing Script', cursive; color: var(--secondary); }
        .btn-love {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white; padding: 14px 40px; border-radius: 100px;
            font-weight: bold; text-transform: uppercase; cursor: pointer; border: none;
            box-shadow: 0 10px 20px -5px rgba(255, 77, 109, 0.5);
            transition: all 0.3s ease;
        }
        .btn-love:hover { transform: scale(1.05); filter: brightness(1.1); }
        #rabbit-gift {
            position: fixed; bottom: -400px; left: 50%;
            transform: translateX(-50%); z-index: 100;
            transition: all 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 220px; text-align: center;
        }
        input {
            background: rgba(255, 255, 255, 0.05); border: 1px solid var(--secondary);
            color: white; padding: 12px; border-radius: 15px; text-align: center; outline: none;
        }
        .carousel-view { perspective: 1000px; height: 300px; display: flex; justify-content: center; align-items: center; }
        .carousel-wheel { width: 150px; height: 200px; position: relative; transform-style: preserve-3d; }
        .carousel-item { 
            position: absolute; width: 150px; height: 200px; 
            border-radius: 15px; overflow: hidden; border: 2px solid var(--secondary);
            backface-visibility: hidden;
        }
        .carousel-item img { width: 100%; height: 100%; object-fit: cover; }
        #together-timer { text-shadow: 0 0 10px rgba(255, 182, 193, 0.8); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .animate-pulse-slow { animation: pulse-slow 3s infinite ease-in-out; }
        @keyframes pulse-slow { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.03); opacity: 0.9; } }
        
        .led-border {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 50;
            box-shadow: inset 0 0 50px #ff4d6d, inset 0 0 100px rgba(255, 77, 109, 0.2);
            opacity: 0; transition: opacity 1s ease;
        }
        .led-active { opacity: 1; animation: led-pulse 1.5s infinite alternate; }
        @keyframes led-pulse {
            from { box-shadow: inset 0 0 40px #ff4d6d; }
            to { box-shadow: inset 0 0 80px #ff85a1, inset 0 0 120px rgba(255, 133, 161, 0.4); }
        }
    </style>
</head>
<body>
    <div id="led-effect" class="led-border"></div>
    <audio id="bgMusic" loop><source src="edsherran.mp3" type="audio/mpeg"></audio>
    <div id="canvas-container"></div>

    <div id="app" class="flex items-center justify-center min-h-screen relative z-10 p-6 text-center">
        
        <div class="step glass-card active p-8 max-w-sm w-full" id="step0">
            <div class="text-5xl mb-6">üîê</div>
            <h2 class="text-white text-xl font-bold mb-6">Nh·∫≠p m·∫≠t m√£ ƒë·ªÉ m·ªü qu√†...</h2>
            <input type="password" id="passInput" placeholder="8 con s·ªë n√®..." class="w-full mb-4 focus:ring-2 ring-pink-400">
            <p id="error-msg" class="text-red-400 text-sm hidden mb-4">Sai r·ªìi nha, th·ª≠ l·∫°i ƒëi b√© iu! üå∏</p>
            <button class="btn-love w-full" id="btn-unlock">X√°c nh·∫≠n ‚ù§Ô∏è</button>
        </div>

        <div class="step glass-card p-10 max-w-md w-full" id="step1">
            <div class="handwritten text-5xl mb-6">Ch√†o c√¥ng ch√∫a...</div>
            <p class="text-gray-300 text-lg mb-8">H√¥m nay l√† m·ªôt ng√†y c·ª±c k·ª≥ ƒë·∫∑c bi·ªát, anh c√≥ ƒëi·ªÅu n√†y mu·ªën n√≥i v·ªõi em.</p>
            <button class="btn-love" id="btn-1">Xem ƒë√≥ l√† g√¨ nh√© ‚ù§Ô∏è</button>
        </div>

        <div class="step glass-card p-10 max-w-md w-full" id="step2">
            <h2 class="text-4xl font-bold text-white mb-6">Happy Birthday! üéÇ</h2>
            <p class="text-pink-300 text-xl font-medium mb-4">C√¥ g√°i 12/01/2006</p>
            <p class="text-gray-400 mb-8 italic">"C·∫£m ∆°n em v√¨ ƒë√£ l√† m·ªôt ph·∫ßn tuy·ªát v·ªùi nh·∫•t trong cu·ªôc ƒë·ªùi anh."</p>
            <button class="btn-love" id="btn-2">Ti·∫øp t·ª•c ‚ú®</button>
        </div>

        <div class="step glass-card p-8 max-w-2xl w-full" id="step3">
            <h2 class="text-3xl font-bold mb-8 text-pink-400">V√¨ sao em tuy·ªát v·ªùi?</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <div class="p-4 bg-white/5 rounded-2xl border border-white/10"><div class="text-3xl mb-2">‚ú®</div><h3 class="text-lg font-bold">S·ª± t·ª≠ t·∫ø</h3><p class="text-xs text-gray-400">Tr√°i tim ·∫•m √°p c·ªßa em lu√¥n khi·∫øn anh t·ª± h√†o.</p></div>
                <div class="p-4 bg-white/5 rounded-2xl border border-white/10"><div class="text-3xl mb-2">üòä</div><h3 class="text-lg font-bold">N·ª• c∆∞·ªùi</h3><p class="text-xs text-gray-400">N·ª• c∆∞·ªùi t·ªèa n·∫Øng gi√∫p anh xua tan m·ªçi m·ªát m·ªèi.</p></div>
                <div class="p-4 bg-white/5 rounded-2xl border border-white/10"><div class="text-3xl mb-2">üåü</div><h3 class="text-lg font-bold">NƒÉng l∆∞·ª£ng</h3><p class="text-xs text-gray-400">S·ª± nhi·ªát huy·∫øt c·ªßa em truy·ªÅn c·∫£m h·ª©ng cho anh.</p></div>
            </div>
            <button class="btn-love" id="btn-3">M·ªôt ƒëi·ªÅu cu·ªëi c√πng...</button>
        </div>

        <div class="step glass-card p-8 max-w-2xl w-full" id="step-gallery">
            <h2 class="handwritten text-4xl mb-6 text-pink-300">V·∫ª ƒë·∫πp c·ªßa em...</h2>
            <div class="carousel-view mb-8">
                <div class="carousel-wheel" id="wheel">
                    <div class="carousel-item"><img src="em1.jpg"></div>
                    <div class="carousel-item"><img src="em2.jpg"></div>
                    <div class="carousel-item"><img src="em3.jpg"></div>
                    <div class="carousel-item"><img src="em4.jpg"></div>
                    <div class="carousel-item"><img src="em5.jpg"></div>
                </div>
            </div>
            <div id="together-timer" class="handwritten text-2xl mt-4 text-pink-200"></div>
            <button class="btn-love mt-6" id="btn-to-next">ƒêi·ªÅu cu·ªëi c√πng... ‚ù§Ô∏è</button>
        </div>

        <div class="step glass-card p-10 max-w-md w-full" id="step-melted">
            <h2 class="handwritten text-4xl mb-6 text-pink-400">Awwwwwwww...</h2>
            <p class="text-white text-2xl mb-6 italic">"My heart melted completely"</p>
            <div class="mb-8 rounded-2xl overflow-hidden border-4 border-white shadow-xl">
                <img src="melted.jpg" alt="Heart Melted" class="w-full object-cover animate-pulse-slow">
            </div>
            <button class="btn-love" id="btn-to-medical">V√† anh mu·ªën n√≥i l√†... ‚ù§Ô∏è</button>
        </div>

        <div class="step glass-card p-8 max-w-md w-full text-center" id="step-medical-game">
            <h2 class="handwritten text-3xl mb-4 text-pink-400">Emergency! üö®</h2>
            <p class="text-gray-300 mb-4 italic text-sm">"Tim anh tan ch·∫£y r·ªìi ƒë·ª©ng b√≥ng lu√¥n... b√°c sƒ© c·ª©u anh v·ªõi!"</p>
            <div class="bg-black border-2 border-green-500/50 rounded-lg p-4 mb-6 relative overflow-hidden h-32">
                <canvas id="ecg-canvas" width="400" height="100" class="w-full h-full"></canvas>
                <div id="status-text" class="absolute top-2 right-2 text-red-500 text-xs font-mono animate-pulse">ASYSTOLE</div>
            </div>
            <p id="cpr-instruction" class="text-white mb-6 font-bold">H√£y nh·∫•n "√âP TIM" 5 l·∫ßn ƒë·ªÉ h·ªìi sinh!</p>
            <button class="btn-love px-8 py-3" id="btn-cpr">‚ù§Ô∏è √âP TIM (CPR)</button>
            <div id="cpr-progress" class="mt-4 text-pink-300 text-sm">Ti·∫øn ƒë·ªô: 0/5</div>
        </div>
        
        <div class="step glass-card p-10 max-w-md w-full" id="step4">
            <div class="handwritten text-4xl mb-6">G·ª≠i em...</div>
            <div id="typing-text" class="text-white text-xl leading-relaxed min-h-[100px]"></div>
            <button class="btn-love mt-8" id="final-btn" style="display: none;">Nh·∫≠n qu√† n√®! ‚ù§Ô∏è</button>
        </div>

        <div id="rabbit-gift">
            <img src="https://media.giphy.com/media/VeMhxrpfpux7cKyQ4g/giphy.gif" alt="Cute Bunny" class="mx-auto w-40 drop-shadow-2xl">
            <div class="bg-white text-pink-500 font-bold py-2 px-6 rounded-full shadow-2xl mt-4 inline-block border-2 border-pink-100">Chocolate cho baby! üç´</div>
        </div>
    </div>

    <script>
        // 1. Background Animation
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        camera.position.z = 30;

        const heartShape = new THREE.Shape();
        heartShape.moveTo(0,0); heartShape.bezierCurveTo(0,0,-1,1,-2,1); heartShape.bezierCurveTo(-4,1,-4,-1.5,-4,-1.5);
        heartShape.bezierCurveTo(-4,-3,-2,-5,0,-7); heartShape.bezierCurveTo(2,-5,4,-3,4,-1.5); heartShape.bezierCurveTo(4,-1.5,4,1,2,1);
        
        const hearts = [];
        for(let i=0; i<30; i++){
            const mesh = new THREE.Mesh(new THREE.ShapeGeometry(heartShape), new THREE.MeshBasicMaterial({ color: 0xff4d6d, transparent: true, opacity: 0.3 }));
            mesh.position.set(Math.random()*80-40, Math.random()*80-40, Math.random()*40-20);
            mesh.rotation.z = Math.PI; mesh.scale.set(0.4, 0.4, 0.4);
            scene.add(mesh); hearts.push(mesh);
        }

        function animate() {
            requestAnimationFrame(animate);
            hearts.forEach(h => { h.position.y += 0.05; if(h.position.y > 30) h.position.y = -30; });
            renderer.render(scene, camera);
        }
        animate();

        // 2. ECG & CPR Game Logic
        let cprCount = 0;
        let isEcgRunning = false;
        let xEcg = 0;

        function playBeep(frequency = 880, duration = 0.1) {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            setTimeout(() => oscillator.stop(), duration * 1000);
        }

        function drawEcg() {
            const canvas = document.getElementById('ecg-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const isHealthy = cprCount >= 5;
            ctx.strokeStyle = isHealthy ? '#4ade80' : '#ef4444';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(xEcg, 50);

            if (isHealthy) {
                if (xEcg % 60 === 0) playBeep(880, 0.08); 
                ctx.lineTo(xEcg + 5, 50); ctx.lineTo(xEcg + 10, 40); ctx.lineTo(xEcg + 15, 50);
                ctx.lineTo(xEcg + 20, 50); ctx.lineTo(xEcg + 25, 10); ctx.lineTo(xEcg + 30, 80);
                ctx.lineTo(xEcg + 35, 50); ctx.lineTo(xEcg + 45, 50); ctx.lineTo(xEcg + 55, 45);
                ctx.lineTo(xEcg + 60, 50);
                xEcg += 60;
            } else {
                if (xEcg % 100 === 0) playBeep(440, 0.4); 
                ctx.lineTo(xEcg + 20, 50);
                xEcg += 20;
            }
            ctx.stroke();
            if (xEcg > canvas.width) { ctx.clearRect(0, 0, canvas.width, canvas.height); xEcg = 0; }
        }

        function startEcgAnimation() {
            isEcgRunning = true;
            function loop() {
                if(!isEcgRunning) return;
                drawEcg();
                setTimeout(loop, 120);
            }
            loop();
        }

        document.getElementById('btn-cpr').onclick = () => {
            cprCount++;
            document.getElementById('cpr-progress').innerText = `Ti·∫øn ƒë·ªô: ${cprCount}/5`;
            gsap.fromTo("#step-medical-game", { x: -5 }, { x: 5, duration: 0.05, repeat: 3, yoyo: true });

            if (cprCount === 5) {
                document.getElementById('status-text').innerText = "SINUS RHYTHM";
                document.getElementById('status-text').className = "absolute top-2 right-2 text-green-500 text-xs font-mono";
                document.getElementById('cpr-instruction').innerText = "H·ªìi sinh th√†nh c√¥ng! Anh s·ªëng l·∫°i r·ªìi ‚ù§Ô∏è";
                setTimeout(() => {
                    isEcgRunning = false;
                    showStep('step-medical-game', 'step4');
                    startTyping();
                }, 2500);
            }
        };

        // 3. Logic Control
        function showStep(currentId, nextId) {
            const curr = document.getElementById(currentId);
            const next = document.getElementById(nextId);
            gsap.to(curr, { opacity: 0, scale: 0.8, duration: 0.5, onComplete: () => {
                curr.classList.remove('active');
                next.classList.add('active');
                gsap.fromTo(next, { opacity: 0, scale: 0.8 }, { opacity: 1, scale: 1, duration: 0.8 });
                if(nextId === 'step-gallery') initGallery();
            }});
        }

        function initGallery() {
            const items = document.querySelectorAll('.carousel-item');
            items.forEach((item, i) => {
                const angle = (i / items.length) * 360;
                gsap.set(item, { rotationY: angle, transformOrigin: "50% 50% -300px" });
            });
            gsap.to("#wheel", { rotationY: 360, duration: 20, repeat: -1, ease: "none" });
        }

        // 4. Event Listeners
        document.getElementById('btn-unlock').onclick = () => {
            if(document.getElementById('passInput').value === "12012006") showStep('step0', 'step1');
            else {
                document.getElementById('error-msg').classList.remove('hidden');
                gsap.fromTo("#step0", { x: -10 }, { x: 10, duration: 0.1, repeat: 5, yoyo: true });
            }
        };

        document.getElementById('btn-1').onclick = () => { document.getElementById('bgMusic').play(); showStep('step1', 'step2'); };
        document.getElementById('btn-2').onclick = () => showStep('step2', 'step3');
        document.getElementById('btn-3').onclick = () => showStep('step3', 'step-gallery');
        document.getElementById('btn-to-next').onclick = () => showStep('step-gallery', 'step-melted');
        
        // Melted -> Game
        document.getElementById('btn-to-medical').onclick = () => {
            showStep('step-melted', 'step-medical-game');
            startEcgAnimation();
        };

        function startTyping() {
            const msgs = ["Ch√∫c m·ª´ng sinh nh·∫≠t em! ‚ù§Ô∏è", "C·∫£m ∆°n em v√¨ ƒë√£ ƒë·∫øn b√™n anh...", "Anh s·∫Ω lu√¥n y√™u th∆∞∆°ng v√† b·∫£o v·ªá em."];
            let l = 0, c = 0; const t = document.getElementById('typing-text');
            t.innerHTML = "";
            function type() {
                if(l < msgs.length) {
                    if(c < msgs[l].length) { t.innerHTML += msgs[l].charAt(c); c++; setTimeout(type, 60); }
                    else { t.innerHTML += "<br>"; l++; c=0; setTimeout(type, 700); }
                } else { document.getElementById('final-btn').style.display = 'inline-block'; }
            }
            type();
        }

        document.getElementById('final-btn').onclick = function() {
            document.getElementById('led-effect').classList.add('led-active');
            const duration = 15 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
            function randomInRange(min, max) { return Math.random() * (max - min) + min; }
            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                const particleCount = 50 * (timeLeft / duration);
                confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
                confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
            }, 250);
            document.getElementById('rabbit-gift').style.bottom = "15%";
            this.innerText = "Y√äU EM M√ÉI M√ÉI! ‚ù§Ô∏è";
            gsap.to(this, { scale: 1.2, duration: 0.5, repeat: -1, yoyo: true });
        };

        function updateTimer() {
            const startDate = new Date('2024-12-31T00:00:00');
            const now = new Date();
            const diff = now - startDate;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const mins = Math.floor((diff / 1000 / 60) % 60);
            const secs = Math.floor((diff / 1000) % 60);
            const timerElement = document.getElementById('together-timer');
            if (timerElement) {
                timerElement.innerHTML = `Ch√∫ng m√¨nh ƒë√£ h·∫°nh ph√∫c b√™n nhau <br> <span class="text-4xl">${days} ng√†y ${hours} gi·ªù ${mins} ph√∫t ${secs} gi√¢y</span>`;
            }
        }
        setInterval(updateTimer, 1000);
        updateTimer();
    </script>
</body>
</html>
